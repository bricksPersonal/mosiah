<!DOCTYPE html>
<!-- Based on a tutorial from https://travishorn.com/updating-dynamic-data-in-d3-15ce4a9fa856-->
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>D3 Starter</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/5.9.7/d3.min.js"></script>
</head>

<body>
  <div>
    <button id="removeCircle" onClick="removeCircle()">--------</button>
    <button id="addCircle" onClick="addCircle()">+++++++</button>
  </div>
  <div>
    <svg width="1000" height="1000" id="mySVG"></svg>
  </div>
  <script>
    //const data = [1, 1, 1]; // We want to visualize this as 3 circles
    const ZARAHEMLA_Y = 3;
    const WILDERNES_Y = 2;
    const LAND_of_NEPHI_Y = 1;
    const LAND_OF_FIRST_INHERITANCE_Y = 0;
    const labels = ["Jerusalem", "Jerusalem_Wilderness", "Bountiful", "Crossing the Sea", "Land of First Inheritance", "Land of Nephi", "Wilderness", "Zarahemla"]

    const data = [
      {
        id: 0,
        color: "purple",
        name: "Lehi's Family",
        y: labels.indexOf("Jerusalem"),
        t: 0,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "purple",
        name: "Lehi's Family",
        y: labels.indexOf("Jerusalem_Wilderness"),
        t: 1,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "purple",
        name: "Lehi's Family",
        y: labels.indexOf("Bountiful"),
        t: 2,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "purple",
        name: "Lehi's Family",
        y: labels.indexOf("Crossing the Sea"),
        t: 3,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "purple",
        name: "Lehi's Family",
        y: labels.indexOf("Land of First Inheritance"),
        t: 4,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Land of Nephi"),
        t: 5,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of First Inheritance"),
        t: 5,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Wilderness"),
        t: 6,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of First Inheritance"),
        t: 6,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Zarahemla"),
        t: 7,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of Nephi"),
        t: 7,
        x: 0,
        radius: 1
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Zarahemla"),
        t: 8,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of Nephi"),
        t: 8,
        x: 0,
        radius: 1
      },
      {
        id: 2,
        color: "yellow",
        name: "Zeniff",
        y: labels.indexOf("Land of Nephi"),
        t: 8,
        x: 1,
        radius: .5
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Zarahemla"),
        t: 9,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of Nephi"),
        t: 9,
        x: 0,
        radius: 1
      },
      {
        id: 2,
        color: "yellow",
        name: "Zeniff",
        y: labels.indexOf("Land of Nephi"),
        t: 9,
        x: 1,
        radius: .5
      },
      {
        id: 3,
        color: "orange",
        name: "Alma's People",
        y: labels.indexOf("Wilderness"),
        t: 9,
        x: 2,
        radius: .5
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Zarahemla"),
        t: 10,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of Nephi"),
        t: 10,
        x: 0,
        radius: 1
      },
      {
        id: 2,
        color: "yellow",
        name: "Zeniff",
        y: labels.indexOf("Zarahemla"),
        t: 10,
        x: 1,
        radius: .5
      },
      {
        id: 3,
        color: "orange",
        name: "Alma's People",
        y: labels.indexOf("Wilderness"),
        t: 10,
        x: 2,
        radius: .5
      },
      {
        id: 0,
        color: "blue",
        name: "Nephites",
        y: labels.indexOf("Zarahemla"),
        t: 11,
        x: 0,
        radius: 1
      },
      {
        id: 1,
        color: "red",
        name: "Lamanites",
        y: labels.indexOf("Land of Nephi"),
        t: 11,
        x: 0,
        radius: 1
      },
      {
        id: 2,
        color: "yellow",
        name: "Zeniff",
        y: labels.indexOf("Zarahemla"),
        t: 11,
        x: 1,
        radius: .5
      },
      {
        id: 3,
        color: "orange",
        name: "Alma's People",
        y: labels.indexOf("Zarahemla"),
        t: 11,
        x: 2,
        radius: .5
      },
      
    ]

    const time = [
      {
        t: 0,
        name: "Lehi's Vision"
      },
      {
        t: 1,
        name: "Lehi Leaves"
      },
      {
        t: 2,
        name: "Arrival at Sea Shore"
      },
      {
        t: 3,
        name: "Crossing the Ocean"
      },
      {
        t: 4,
        name: "In the Promised Land"
      },
      {
        t: 5,
        name: "Lehi Dies"
      },
      {
        t: 6,
        name: "Mosiah I Flees"
      },
      {
        t: 7,
        name: "Mosiah I Finds Muelekites"
      },
      {
        t: 8,
        name: "Zenif Returns to Land of Nephi"
      },
      {
        t: 9,
        name: "Alma the Elder's People Flee"
      },
      {
        t: 10,
        name: "Limhi's People Escape"
      },
      {
        t: 11,
        name: "Alma's People Escape"
      },
    ]
    let showTime = [];
    let t = 0;
    const circleRadius = 40;
    const circleDiameter = circleRadius * 2;
    const fontSize = '1rem';

    function plot(data, svg) {
      const t = d3.transition()
        .duration(1000)
        .ease(d3.easeBack);

      const location_text = svg
        .selectAll('location_text')
        .data(labels, d => d)
        .join(
          enter => enter
            .append('text')
            .classed('location_text', true)
            .text(d => d)
            .attr("x", 15)
            .attr("y", (d, i) => circleRadius + i * circleDiameter + 100)
        )

      const main_text = svg
        .selectAll('.main_text')
        .data(showTime, d => d)
        .join(
          enter => enter
            .append('text')
            .classed('main_text', true)
            .attr('font-size', '3rem')
            .attr('x', 100)
            .attr('y', 100),
          update => update,
          exit => exit,
        )
        .text(d => d.name)



      const g = svg
        .selectAll('g')
        .data(data, d => d.id)
        .join(
          enter => enter
            .append('g')
            .attr('transform', d => `translate(${200 + circleRadius + (d.x * circleDiameter)} ${circleRadius + d.y * circleDiameter + 100})`),
          update => update
            .transition(t)
            .attr('transform', d => `translate(${200 + circleRadius + (d.x * circleDiameter)} ${circleRadius + d.y * circleDiameter + 100})`)
        )

      const circle = g
        .selectAll('circle')
        .data(d => [d], d => d.id)
        .join(
          enter => enter
            .append('circle')
            .attr('r', d => d.radius * circleRadius)
            .style('fill', d => d.color),
          update => update
            .transition(t)
            .style('fill', d => d.color)
        )

      const text_g = g
        .selectAll('.text_g')
        .data(d => [d], d => d.id)
        .join(
          enter => enter
            .append('g')
            .classed('text_g', true)
            .attr('transform', 'translate(0, 10)')
        )

      const names_shadow = text_g
        .selectAll('.people_shadow')
        .data(d => [d], d => d.id)
        .join(
          enter => enter
            .append('text')
            .classed('people_shadow', true)
            .text(d => d.name)
            .style('fill', 'white')
            .style('font-size', fontSize)
            .style('text-anchor', "middle")
            .attr('transform', 'translate(-1, -1)')
        )

      const names = text_g
        .selectAll('.people')
        .data(d => [d], d => d.id)
        .join(
          enter => enter
            .append('text')
            .classed('people', true)
            .text(d => d.name)
            .style('fill', 'black')
            .style('font-size', fontSize)
            .style('text-anchor', "middle")
        )


      // const circle = svg
      //   .selectAll('circle')
      //   .data(data, d => d.id)
      //   .join(
      //     enter => enter
      //       .append('circle')
      //       .attr('r', circleRadius / 2).call(enter => enter
      //         .transition(t)
      //         .attr('r', circleRadius))
      //       .attr('cx', (d, i) => 100 + circleRadius + (d.x * circleDiameter))
      //       .attr('cy', d => circleRadius + d.y * circleDiameter),
      //     update => update
      //       .transition(t).attr('cy', d => circleRadius + d.y * circleDiameter)
      //       .attr('cx', (d, i) => 100 + circleRadius + (d.x * circleDiameter)),
      //     exit => exit
      //       .call(exit => exit.transition(t).style("opacity", "0").remove())
      //   )
      //   .style('fill', d => d.color)

      // const happy = svg
      //   .selectAll('.people')
      //   .data(data, d => d.id)
      //   .join(
      //     enter => enter
      //       .append('text')
      //       .classed('people', true)
      //       .attr('x', (d, i) => 100 + circleRadius + (d.x * circleDiameter))
      //       .attr('y', d => circleRadius + d.y * circleDiameter)
      //       .text(d => d.name)
      //       .attr('font-size', '2rem'),
      //     update => update
      //       .transition(t).attr('cy', d => circleRadius + d.y * circleDiameter)
      //       .attr('cx', (d, i) => 100 + circleRadius + (d.x * circleDiameter)),
      //     exit => exit

      //   ).attr('font-size', '2rem')

    };

    const svg = d3.select('#mySVG');
    prep(data);

    function addCircle() {
      t++;
      let max = Math.max(...data.map(i => i.t))
      if (t > max)
        t = max;
      prep(data)
    }

    function removeCircle() {
      t--;
      if (t < 0)
        t = 0;
      prep(data);
    }
    function prep(data) {
      let toShow = data.filter(i => i.t == t);
      showTime = time.filter(i => i.t == t)
      plot(toShow, svg);
    }
  </script>

</body>

</html>
